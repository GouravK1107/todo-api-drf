{% load static %}
<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>New Password â€” Tasko</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,400&family=Fraunces:ital,opsz,wght@0,9..144,300;0,9..144,600;0,9..144,700;1,9..144,400&display=swap" rel="stylesheet"/>
  <style>
    *, *::before, *::after { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       DESIGN TOKENS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    :root {
      --p:           #4F46E5;
      --p-hover:     #3730a3;
      --p-glow:      rgba(79,70,229,.22);
      --p-faint:     #eef2ff;
      --a:           #10B981;
      --a-glow:      rgba(16,185,129,.22);
      --bg:          #F3F4F8;
      --card:        #FFFFFF;
      --text:        #111827;
      --text-2:      #6B7280;
      --text-3:      #9CA3AF;
      --danger:      #EF4444;
      --border:      #E5E7EB;
      --border-focus:#4F46E5;
      --shadow:      0 24px 64px rgba(0,0,0,.12), 0 4px 20px rgba(0,0,0,.06);
      --r:           12px;
      --r-sm:        8px;
      --ease:        200ms ease;
      --spring:      340ms cubic-bezier(.34,1.56,.64,1);
    }
    [data-theme="dark"] {
      --bg:     #0f172a;
      --card:   #1e293b;
      --text:   #f1f5f9;
      --text-2: #94a3b8;
      --text-3: #64748b;
      --border: #334155;
      --shadow: 0 24px 64px rgba(0,0,0,.5), 0 4px 20px rgba(0,0,0,.3);
    }

    html, body { 
      height: 100%; 
      font-family: 'DM Sans', sans-serif; 
      -webkit-font-smoothing: antialiased; 
    }
    
    body {
      display: flex;
      min-height: 100vh;
      background: var(--bg);
      color: var(--text);
      transition: background .35s ease, color .35s ease;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       THEME TOGGLE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .theme-toggle {
      position: fixed;
      top: 24px;
      right: 24px;
      z-index: 999;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--card);
      border: 1.5px solid var(--border);
      box-shadow: 0 2px 14px rgba(0,0,0,.1);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-2);
      transition: all 250ms cubic-bezier(.34,1.56,.64,1);
    }
    .theme-toggle:hover {
      border-color: var(--p);
      color: var(--p);
      transform: rotate(22deg) scale(1.1);
      box-shadow: 0 4px 18px var(--p-glow);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       LEFT PANEL â€” 50% width
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .panel-left {
      width: 50%;
      position: relative;
      background: linear-gradient(148deg, #064e3b 0%, #047857 35%, #059669 65%, #0f172a 100%);
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 48px 56px;
      overflow: hidden;
      min-height: 100vh;
    }

    /* Ambient glow layers */
    .panel-left::before {
      content: '';
      position: absolute;
      inset: 0;
      background:
        radial-gradient(ellipse 80% 70% at 20% 20%, rgba(16,185,129,.35) 0%, transparent 60%),
        radial-gradient(ellipse 60% 60% at 80% 90%, rgba(245,158,11,.15) 0%, transparent 60%);
      pointer-events: none;
      animation: ambientShift 8s ease-in-out infinite alternate;
    }
    @keyframes ambientShift {
      from { opacity: 0.8; transform: scale(1); }
      to { opacity: 1; transform: scale(1.02); }
    }

    /* Dot-grid texture */
    .panel-left::after {
      content: '';
      position: absolute;
      inset: 0;
      background-image: radial-gradient(circle, rgba(255,255,255,.06) 1px, transparent 1px);
      background-size: 32px 32px;
      pointer-events: none;
    }

    /* â”€â”€ Brand mark â”€â”€ */
    .brand {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      text-decoration: none;
      position: relative;
      z-index: 2;
      margin-bottom: 20px;
    }
    .brand-gem {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: rgba(255,255,255,.12);
      border: 1.5px solid rgba(255,255,255,.25);
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Fraunces', serif;
      font-size: 20px;
      font-weight: 700;
      color: #fff;
      box-shadow: 0 4px 15px rgba(0,0,0,.2);
    }
    .brand-name {
      font-family: 'Fraunces', serif;
      font-size: 24px;
      font-weight: 700;
      color: #fff;
      letter-spacing: -.4px;
    }

    /* â”€â”€ Left panel content â”€â”€ */
    .panel-left-body {
      position: relative;
      z-index: 2;
      max-width: 480px;
      margin: 40px 0;
    }
    .pl-eyebrow {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: rgba(255,255,255,.1);
      border: 1px solid rgba(255,255,255,.15);
      border-radius: 100px;
      padding: 6px 16px 6px 10px;
      font-size: 13px;
      font-weight: 600;
      color: rgba(255,255,255,.9);
      margin-bottom: 32px;
      backdrop-filter: blur(4px);
    }
    .pl-eyebrow-dot {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
    }

    .pl-heading {
      font-family: 'Fraunces', serif;
      font-size: 48px;
      font-weight: 700;
      color: #fff;
      letter-spacing: -1.5px;
      line-height: 1.1;
      margin-bottom: 20px;
    }
    .pl-heading em {
      font-style: italic;
      color: #fde047;
      display: block;
      margin-top: 5px;
    }

    .pl-sub {
      font-size: 16px;
      color: rgba(255,255,255,.7);
      line-height: 1.7;
      max-width: 400px;
    }

    /* â”€â”€ Social proof â”€â”€ */
    .social-proof {
      position: relative;
      z-index: 2;
      margin-top: auto;
    }
    .sp-avatars {
      display: flex;
      margin-bottom: 12px;
    }
    .sp-av {
      width: 38px;
      height: 38px;
      border-radius: 50%;
      border: 2.5px solid rgba(255,255,255,.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 700;
      color: #fff;
      margin-left: -12px;
      flex-shrink: 0;
      backdrop-filter: blur(4px);
    }
    .sp-av:first-child {
      margin-left: 0;
    }
    .sp-text {
      font-size: 14px;
      color: rgba(255,255,255,.6);
      line-height: 1.6;
    }
    .sp-text strong {
      color: rgba(255,255,255,.9);
      font-weight: 700;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RIGHT PANEL â€” 50% width
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    .panel-right {
      width: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
      background: var(--bg);
      min-height: 100vh;
      overflow-y: auto;
    }
    
    .form-shell {
      width: 100%;
      max-width: 440px;
      margin: 0 auto;
    }

    /* â”€â”€ Step pill â”€â”€ */
    .step-pill {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      background: var(--p-faint);
      border: 1px solid rgba(79,70,229,.2);
      border-radius: 100px;
      padding: 5px 14px 5px 6px;
      font-size: 12px;
      font-weight: 700;
      color: var(--p);
      margin-bottom: 28px;
    }
    .sp-num {
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: var(--p);
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 800;
    }

    /* â”€â”€ Heading â”€â”€ */
    .form-title {
      font-family: 'Fraunces', serif;
      font-size: 36px;
      font-weight: 700;
      letter-spacing: -.8px;
      line-height: 1.2;
      color: var(--text);
      margin-bottom: 10px;
    }
    .form-sub {
      font-size: 15px;
      color: var(--text-2);
      line-height: 1.6;
      margin-bottom: 36px;
    }

    /* â”€â”€ Form fields â”€â”€ */
    .field {
      margin-bottom: 24px;
    }
    .field label {
      display: block;
      font-size: 13px;
      font-weight: 700;
      color: var(--text-2);
      margin-bottom: 8px;
      letter-spacing: .02em;
    }

    .input-wrap {
      position: relative;
    }
    .input-icon {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-3);
      pointer-events: none;
      z-index: 1;
      transition: color var(--ease);
    }
    .input-wrap:focus-within .input-icon {
      color: var(--p);
    }

    .fi {
      width: 100%;
      padding: 14px 45px 14px 45px;
      border: 1.5px solid var(--border);
      border-radius: 12px;
      background: var(--card);
      color: var(--text);
      font-family: 'DM Sans', sans-serif;
      font-size: 15px;
      outline: none;
      transition: all var(--ease);
    }
    .fi:focus {
      border-color: var(--border-focus);
      box-shadow: 0 0 0 4px var(--p-glow);
    }
    .fi::placeholder {
      color: var(--text-3);
    }
    .fi.valid {
      border-color: var(--a);
    }
    .fi.error {
      border-color: var(--danger);
      box-shadow: 0 0 0 4px rgba(239,68,68,.12);
    }

    /* Password toggle button */
    .toggle-pw {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      cursor: pointer;
      color: var(--text-3);
      padding: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: color var(--ease);
      z-index: 1;
    }
    .toggle-pw:hover {
      color: var(--p);
    }

    /* Password strength meter */
    .pw-strength {
      margin-top: 12px;
      padding: 12px;
      background: var(--card);
      border: 1px solid var(--border);
      border-radius: 10px;
    }
    .strength-bars {
      display: flex;
      gap: 6px;
      margin-bottom: 6px;
    }
    .strength-bar {
      height: 4px;
      flex: 1;
      background: var(--border);
      border-radius: 99px;
      transition: all var(--ease);
    }
    .strength-bar.weak { background: #EF4444; }
    .strength-bar.fair { background: #f59e0b; }
    .strength-bar.good { background: #10B981; }
    .strength-bar.strong { background: #059669; }
    .strength-label {
      font-size: 11px;
      font-weight: 600;
      text-align: right;
      color: var(--text-2);
    }

    /* Error message */
    .field-err {
      font-size: 12px;
      color: var(--danger);
      font-weight: 600;
      margin-top: 6px;
      display: flex;
      align-items: center;
      gap: 5px;
      min-height: 18px;
      opacity: 0;
      transform: translateY(-4px);
      transition: all var(--ease);
    }
    .field-err.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* â”€â”€ Submit button â”€â”€ */
    .submit-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, var(--p) 0%, #6d28d9 100%);
      color: #fff;
      border: none;
      border-radius: 12px;
      font-family: 'DM Sans', sans-serif;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all var(--spring);
      box-shadow: 0 4px 15px var(--p-glow);
      margin-top: 16px;
    }
    .submit-btn:hover {
      background: linear-gradient(135deg, var(--p-hover) 0%, #5b21b6 100%);
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(79,70,229,.4);
    }

    /* Shimmer sweep */
    .submit-btn::after {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 60%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,.15), transparent);
      transform: skewX(-20deg);
      transition: left .5s ease;
    }
    .submit-btn:hover::after {
      left: 150%;
    }

    /* â”€â”€ Loading state â”€â”€ */
    .submit-btn.loading {
      pointer-events: none;
      opacity: .85;
    }
    .btn-inner {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }
    .btn-spinner {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 2px solid rgba(255,255,255,.3);
      border-top-color: #fff;
      animation: spin .65s linear infinite;
      display: none;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    .submit-btn.loading .btn-spinner {
      display: block;
    }
    .submit-btn.loading .btn-arrow {
      display: none;
    }

    /* Success state */
    .submit-btn.success {
      background: linear-gradient(135deg, #059669, #10B981) !important;
    }

    /* â”€â”€ Login redirect â”€â”€ */
    .login-row {
      text-align: center;
      margin-top: 30px;
      font-size: 14px;
      color: var(--text-2);
    }
    .login-row a {
      color: var(--p);
      font-weight: 600;
      text-decoration: none;
      transition: opacity var(--ease);
    }
    .login-row a:hover {
      opacity: .8;
      text-decoration: underline;
    }

    /* Toast notification */
    .toast {
      position: fixed;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--card);
      color: var(--text);
      padding: 14px 28px;
      border-radius: 50px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      border: 1px solid var(--border);
      z-index: 9999;
      font-weight: 500;
      display: none;
      transition: transform 0.3s ease;
    }
    .toast.show {
      transform: translateX(-50%) translateY(0);
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       RESPONSIVE
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
    @media(max-width: 1024px) {
      .panel-left {
        padding: 40px;
      }
      .pl-heading {
        font-size: 42px;
      }
    }
    
    @media(max-width: 900px) {
      body {
        flex-direction: column;
      }
      .panel-left, .panel-right {
        width: 100%;
        min-height: auto;
      }
      .panel-left {
        padding: 60px 40px 40px;
      }
      .panel-right {
        padding: 60px 40px;
      }
      .theme-toggle {
        top: 16px;
        right: 16px;
      }
    }
    
    @media(max-width: 480px) {
      .panel-left, .panel-right {
        padding: 40px 24px;
      }
      .pl-heading {
        font-size: 36px;
      }
      .form-title {
        font-size: 32px;
      }
    }
  </style>
</head>
<body>

<!-- â”€â”€ THEME TOGGLE â”€â”€ -->
<button class="theme-toggle" id="themeBtn" aria-label="Toggle dark mode">
  <svg id="themeIco" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
    <circle cx="12" cy="12" r="5"/>
    <line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/>
    <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
    <line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/>
    <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
  </svg>
</button>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     LEFT PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel-left">
  <!-- Brand -->
  <a href="/" class="brand">
    <div class="brand-gem">T</div>
    <span class="brand-name">Tasko</span>
  </a>

  <!-- Main copy -->
  <div class="panel-left-body">
    <div class="pl-eyebrow">
      <div class="pl-eyebrow-dot">ğŸ”‘</div>
      Step 3 of 3 Â· Reset password
    </div>
    <h2 class="pl-heading">
      Create a new<br/>
      <em>strong password</em>
    </h2>
    <p class="pl-sub">
      Make sure it's at least 8 characters and includes a mix of letters, numbers, and symbols for better security.
    </p>
  </div>

  <!-- Security tips -->
  <div class="social-proof">
    <div class="sp-avatars">
      <div class="sp-av" style="background:linear-gradient(135deg,#a78bfa,#7c3aed)">ğŸ”’</div>
      <div class="sp-av" style="background:linear-gradient(135deg,#f9a8d4,#ec4899)">ğŸ”‘</div>
      <div class="sp-av" style="background:linear-gradient(135deg,#6ee7b7,#059669)">âœ“</div>
    </div>
    <p class="sp-text">
      <strong>Security tip:</strong> Use a unique password you don't use elsewhere.
    </p>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     RIGHT PANEL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="panel-right">
  <div class="form-shell">

    <!-- Step indicator pill -->
    <div class="step-pill">
      <div class="sp-num">3</div>
      Step 3 of 3
    </div>

    <h1 class="form-title">Set new password</h1>
    <p class="form-sub">Choose a strong password you haven't used before.</p>

    <!-- Reset Password Form -->
    <form id="resetPasswordForm" novalidate>
      <input type="hidden" id="email" value="{{ email }}">
      
      <div class="field">
        <label for="newPassword">New password</label>
        <div class="input-wrap">
          <span class="input-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2"/>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
          </span>
          <input type="password" id="newPassword" class="fi" placeholder="Min. 8 characters" autocomplete="new-password"/>
          <button type="button" class="toggle-pw" id="togglePw1" aria-label="Toggle password visibility">
            <svg id="eyeIcon1" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
            </svg>
          </button>
        </div>
        <div class="pw-strength" id="pwStrength" style="display: none;">
          <div class="strength-bars">
            <div class="strength-bar" id="bar1"></div>
            <div class="strength-bar" id="bar2"></div>
            <div class="strength-bar" id="bar3"></div>
            <div class="strength-bar" id="bar4"></div>
          </div>
          <p class="strength-label" id="strengthLabel"></p>
        </div>
        <p class="field-err" id="newPasswordError"></p>
      </div>

      <div class="field">
        <label for="confirmPassword">Confirm new password</label>
        <div class="input-wrap">
          <span class="input-icon">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/>
            </svg>
          </span>
          <input type="password" id="confirmPassword" class="fi" placeholder="Repeat your password" autocomplete="new-password"/>
          <button type="button" class="toggle-pw" id="togglePw2" aria-label="Toggle password visibility">
            <svg id="eyeIcon2" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/>
            </svg>
          </button>
        </div>
        <p class="field-err" id="confirmPasswordError"></p>
      </div>

      <button type="submit" class="submit-btn" id="submitBtn">
        <div class="btn-inner">
          <div class="btn-spinner" id="btnSpinner"></div>
          <span id="btnText">Reset password</span>
          <svg class="btn-arrow" id="btnArrow" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
            <line x1="5" y1="12" x2="19" y2="12"/>
            <polyline points="12 5 19 12 12 19"/>
          </svg>
        </div>
      </button>
    </form>

    <p class="login-row">
      <a href="{% url 'login' %}">â† Back to sign in</a>
    </p>
  </div>
</div>

<!-- Toast notification container -->
<div id="toast" class="toast"><span id="toastTxt"></span></div>

<!-- JavaScript -->
<script src="{% static 'js/reset_password.js' %}"></script>
</body>
</html>